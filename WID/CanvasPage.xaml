<Page
    x:Class="WID.CanvasPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:local="using:WID"
    xmlns:shared="using:Shared"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:muxc="using:Microsoft.UI.Xaml.Controls"
    xmlns:animatedvisuals="using:Microsoft.UI.Xaml.Controls.AnimatedVisuals"
    mc:Ignorable="d"
    >

    <Page.Background>
        <AcrylicBrush
            BackgroundSource="HostBackdrop"
            TintColor="Black"
            TintOpacity="0.6"
            FallbackColor="Black" />
    </Page.Background>
    

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
            <RowDefinition Height="Auto" />
            <RowDefinition Height="Auto" />
        </Grid.RowDefinitions>


        <Grid
            x:Name="TitleBar"
            Background="Transparent"
            Width="Auto"
            Height="Auto"
             >
            <TextBlock
                x:Name="tbAppTitle"
                FontFamily="Segoe UI Variable"
                HorizontalAlignment="Center"
                VerticalAlignment="Center"
                />
            <muxc:ProgressBar
                x:Name="pbFileStatus"
                HorizontalAlignment="Center"
                VerticalAlignment="Center"
                Width="512"
                Value="0"
                IsIndeterminate="False"
                ShowPaused="False"
                ShowError="False"
                />
        </Grid>

        <Popup
            x:Name="ppTextTools"
            Loaded="ToolPopupLoaded"
            Height="Auto"
            HorizontalAlignment="Center"
            VerticalAlignment="Top"
            VerticalOffset="40"
            IsOpen="True"
            Opacity="0"
            IsHitTestVisible="False"
            >
            <Popup.OpacityTransition>
                <ScalarTransition />
            </Popup.OpacityTransition>

            <Border
                x:Name="bdTextTools"
                BorderThickness="4"
                CornerRadius="8"
                >
                <Border.Background>
                    <AcrylicBrush
                        BackgroundSource="HostBackdrop"
                        TintColor="Black"
                        TintOpacity="0.6"
                        FallbackColor="Black"
                        />
                </Border.Background>
                <StackPanel
                    Orientation="Horizontal"
                    HorizontalAlignment="Stretch"
                    Spacing="10"
                    Margin="10"
                    >
                    <Button
                        Click="ToggleBoldText"
                        Content="B"
                        FontWeight="Bold"
                        />
                    <Button
                        Click="ToggleItalicText"
                        Content="I"
                        FontStyle="Italic"
                        />
                    <Button
                        Click="ToggleUnderlinedText"
                        >
                        <TextBlock
                            Text="U"
                            TextDecorations="Underline"
                            />
                    </Button>
                    <Button
                        Click="ToggleStrikethroughText"
                        >
                        <TextBlock
                            Text="S"
                            TextDecorations="Strikethrough"
                            />
                    </Button>
                    <Button
                        Click="ToggleSuperscriptText"
                        >
                        Superscript
                    </Button>
                    <Button
                        Click="ToggleSubscriptText"
                        >
                        Subscript
                    </Button>
                    <TextBox
                        x:Name="tbFindText"
                        Width="200"
                        TextChanged="{x:Bind SearchTextInCurrentBox}"
                        GotFocus="{x:Bind SearchTextInCurrentBox}"
                        LostFocus="{x:Bind RemoveSearchedHighlights}"
                        PlaceholderText="Search current text"
                        HorizontalAlignment="Stretch"
                        />
                    <Button
                        Click="DeleteCurrentTextBox"
                        Foreground="Red"
                        >
                        <FontIcon FontFamily="Segoe Fluent Icons" Glyph="&#xE74D;" />
                    </Button>
                </StackPanel>
            </Border>
        </Popup>

        <StackPanel
            Grid.Row="0"
            Height="36"
            Width="Auto"
            Orientation="Horizontal"
            Spacing="10"
            >
            <Button
                Click="PageBack"
                Background="Transparent"
                BorderBrush="Transparent"
                ToolTipService.ToolTip="Go Back"
                >
                <muxc:AnimatedIcon>
                    <muxc:AnimatedIcon.Source>
                        <animatedvisuals:AnimatedBackVisualSource />
                    </muxc:AnimatedIcon.Source>
                    <muxc:AnimatedIcon.FallbackIconSource>
                        <muxc:FontIconSource FontFamily="Segoe Fluent Icons" Glyph="&#xE112;" />
                    </muxc:AnimatedIcon.FallbackIconSource>
                </muxc:AnimatedIcon>
            </Button>
            <muxc:DropDownButton
                Background="Transparent"
                BorderBrush="Transparent"
                ToolTipService.ToolTip="File Options"
                >
                <muxc:DropDownButton.Content>
                    <FontIcon FontFamily="Segoe Fluent Icons" Glyph="&#xE160;" />
                </muxc:DropDownButton.Content>
                <muxc:DropDownButton.Flyout>
                    <MenuFlyout
                        Placement="BottomEdgeAlignedLeft"
                        >
                        <MenuFlyoutItem
                            Text="Save File"
                            Click="SaveFile"
                            >
                            <MenuFlyoutItem.KeyboardAccelerators>
                                <KeyboardAccelerator Key="S" Modifiers="Control" />
                            </MenuFlyoutItem.KeyboardAccelerators>
                            <MenuFlyoutItem.Icon>
                                <FontIcon FontFamily="Segoe MDL2 Assets" Glyph="&#xE105;" />
                            </MenuFlyoutItem.Icon>
                        </MenuFlyoutItem>
                        <MenuFlyoutSeparator />
                        <MenuFlyoutItem
                            Text="Paste object"
                            Click="PasteObject"
                            >
                            <MenuFlyoutItem.KeyboardAccelerators>
                                <KeyboardAccelerator Key="V" Modifiers="Control" />
                            </MenuFlyoutItem.KeyboardAccelerators>
                            <MenuFlyoutItem.Icon>
                                <FontIcon FontFamily="Segoe Fluent Icons" Glyph="&#xE77F;" />
                            </MenuFlyoutItem.Icon>
                        </MenuFlyoutItem>
                        <MenuFlyoutSeparator />
                        <MenuFlyoutItem
                            x:Name="btUndoStroke"
                            Text="Undo"
                            Click="UndoLastAction"
                            IsEnabled="False"
                            >
                            <MenuFlyoutItem.KeyboardAccelerators>
                                <KeyboardAccelerator Key="Z" Modifiers="Control" />
                            </MenuFlyoutItem.KeyboardAccelerators>
                            <MenuFlyoutItem.Icon>
                                <FontIcon FontFamily="Segoe MDL2 Assets" Glyph="&#xE10E;" />
                            </MenuFlyoutItem.Icon>
                        </MenuFlyoutItem>
                        <MenuFlyoutItem
                            x:Name="btRedoStroke"
                            Text="Redo"
                            Click="RedoLastAction"
                            IsEnabled="False"
                            >
                            <MenuFlyoutItem.KeyboardAccelerators>
                                <KeyboardAccelerator Key="Y" Modifiers="Control" />
                            </MenuFlyoutItem.KeyboardAccelerators>
                            <MenuFlyoutItem.Icon>
                                <FontIcon FontFamily="Segoe MDL2 Assets" Glyph="&#xE10D;" />
                            </MenuFlyoutItem.Icon>
                        </MenuFlyoutItem>
                    </MenuFlyout>
                </muxc:DropDownButton.Flyout>
            </muxc:DropDownButton>
            <muxc:DropDownButton
                Background="Transparent"
                BorderBrush="Transparent"
                ToolTipService.ToolTip="Add item"
                >
                <muxc:DropDownButton.Content>
                    <FontIcon FontFamily="Segoe Fluent Icons" Glyph="&#xE109;" />
                </muxc:DropDownButton.Content>
                <muxc:DropDownButton.Flyout>
                    <MenuFlyout>
                        <MenuFlyoutItem
                            Click="AddPageClicked"
                            Text="Add empty page"
                            ToolTipService.ToolTip="Add empty page (with default template)"
                            >
                            <MenuFlyoutItem.KeyboardAccelerators>
                                <KeyboardAccelerator Key="Add" Modifiers="Control" />
                            </MenuFlyoutItem.KeyboardAccelerators>
                            <MenuFlyoutItem.Icon>
                                <FontIcon FontFamily="Segoe Fluent Icons" Glyph="&#xE160;" />
                            </MenuFlyoutItem.Icon>
                        </MenuFlyoutItem>
                        <MenuFlyoutItem
                            Click="ImportFromFile"
                            Text="Import file"
                            ToolTipService.ToolTip="Import from an image or PDF file"
                            >
                            <MenuFlyoutItem.KeyboardAccelerators>
                                <KeyboardAccelerator Key="I" Modifiers="Control" />
                            </MenuFlyoutItem.KeyboardAccelerators>
                            <MenuFlyoutItem.Icon>
                                <FontIcon FontFamily="Segoe Fluent Icons" Glyph="&#xE8B5;" />
                            </MenuFlyoutItem.Icon>
                        </MenuFlyoutItem>
                        <MenuFlyoutItem
                            Click="OpenCameraForFileImport"
                            Text="Open camera"
                            ToolTipService.ToolTip="Open the camera to capture a document"
                            >
                            <MenuFlyoutItem.KeyboardAccelerators>
                                <KeyboardAccelerator Key="O" Modifiers="Control" />
                            </MenuFlyoutItem.KeyboardAccelerators>
                            <MenuFlyoutItem.Icon>
                                <FontIcon FontFamily="Segoe Fluent Icons" Glyph="&#xE722;" />
                            </MenuFlyoutItem.Icon>
                        </MenuFlyoutItem>
                        <MenuFlyoutItem
                            Click="AddTextToCurrentPage"
                            Text="Add text"
                            ToolTipService.ToolTip="Add an editable text block to the current page"
                            >
                            <MenuFlyoutItem.KeyboardAccelerators>
                                <KeyboardAccelerator Key="T" Modifiers="Control" />
                            </MenuFlyoutItem.KeyboardAccelerators>
                            <MenuFlyoutItem.Icon>
                                <FontIcon FontFamily="Segoe Fluent Icons" Glyph="&#xE8D2;" />
                            </MenuFlyoutItem.Icon>
                        </MenuFlyoutItem>
                    </MenuFlyout>
                </muxc:DropDownButton.Flyout>
            </muxc:DropDownButton>
            <muxc:DropDownButton
                Background="Transparent"
                BorderBrush="Transparent"
                ToolTipService.ToolTip="Export"
                >
                <muxc:DropDownButton.Content>
                    <FontIcon FontFamily="Segoe Fluent Icons" Glyph="&#xEDE1;" />
                </muxc:DropDownButton.Content>
                <muxc:DropDownButton.Flyout>
                    <MenuFlyout>
                        <MenuFlyoutItem
                            Click="ExportCurrentPageAsImage"
                            Text="Current as image"
                            ToolTipService.ToolTip="Export the current page as an image to the chosen location"
                            >
                            <MenuFlyoutItem.Icon>
                                <FontIcon FontFamily="Segoe Fluent Icons" Glyph="&#xEE71;" />
                            </MenuFlyoutItem.Icon>
                            <MenuFlyoutItem.KeyboardAccelerators>
                                <KeyboardAccelerator Key="E" Modifiers="Control" />
                            </MenuFlyoutItem.KeyboardAccelerators>
                        </MenuFlyoutItem>
                        <MenuFlyoutItem
                            Click="PrepareExportAsPDF"
                            Text="Pages as PDF"
                            ToolTipService.ToolTip="Export selected pages as a PDF"
                            >
                            <MenuFlyoutItem.Icon>
                                <FontIcon FontFamily="Segoe Fluent Icons" Glyph="&#xE8A5;" />
                            </MenuFlyoutItem.Icon>
                            <MenuFlyoutItem.KeyboardAccelerators>
                                <KeyboardAccelerator Key="P" Modifiers="Control" />
                            </MenuFlyoutItem.KeyboardAccelerators>
                        </MenuFlyoutItem>
                        <MenuFlyoutItem
                            Click="PrepareExportAsBismuth"
                            Text="Pages as Bismuth file"
                            ToolTipService.ToolTip="Export selected pages to Bismuth file"
                            >
                            <MenuFlyoutItem.Icon>
                                <muxc:ImageIcon Source="/Assets/icon128x128.png" />
                            </MenuFlyoutItem.Icon>
                            <MenuFlyoutItem.KeyboardAccelerators>
                                <KeyboardAccelerator Key="B" Modifiers="Control" />
                            </MenuFlyoutItem.KeyboardAccelerators>
                        </MenuFlyoutItem>
                    </MenuFlyout>
                </muxc:DropDownButton.Flyout>
            </muxc:DropDownButton>
            <ToggleButton
                x:Name="tbSidepane"
                Click="OpenPageOverview"
                Background="Transparent"
                BorderBrush="Transparent"
                ToolTipService.ToolTip="Open page overview"
                >
                <FontIcon FontFamily="Segoe Fluent Icons" Glyph="&#xE82D;" />
            </ToggleButton>
        </StackPanel>

        <muxc:TeachingTip
            x:Name="ttInfoPopup"
            IsOpen="False"
            PreferredPlacement="RightTop"
            />

        <SplitView
            Grid.Row="1"
            x:Name="svPageOverview"
            PaneBackground="{ThemeResource SystemControlBackgroundChromeMediumLowBrush}"
            OpenPaneLength="400"
            DisplayMode="Inline"
            >
            <SplitView.Pane>
                <Grid
                    x:Name="gdSidepane"
                    BorderBrush="{ThemeResource SystemControlAcrylicWindowBrush}"
                    BorderThickness="0, 0, 4, 0"
                    >
                    <Grid.RowDefinitions>
                        <RowDefinition Height="*" />
                        <RowDefinition Height="Auto" />
                    </Grid.RowDefinitions>
                    
                    <GridView
                        x:Name="gvThumbnails"
                        Grid.Row="0"
                        Height="Auto"
                        Width="Auto"
                        HorizontalAlignment="Stretch"
                        VerticalAlignment="Stretch"
                        Loaded="ThumbnailGridViewLoaded"
                        AllowDrop="True"
                        CanReorderItems="True"
                        CanDragItems="True"
                        ReorderMode="Enabled"
                        DragItemsCompleted="PagesReordered"
                        >
                        <GridView.ItemContainerTransitions>
                            <TransitionCollection>
                                <EntranceThemeTransition
                                    IsStaggeringEnabled="True"
                                    />
                            </TransitionCollection>
                        </GridView.ItemContainerTransitions>
                        <GridView.ItemsPanel>
                            <ItemsPanelTemplate>
                                <ItemsWrapGrid
                                    Orientation="Horizontal"
                                    MaximumRowsOrColumns="2"
                                    HorizontalAlignment="Stretch"
                                    VerticalAlignment="Stretch"
                                    />
                            </ItemsPanelTemplate>
                        </GridView.ItemsPanel>
                    </GridView>

                    <Button
                        x:Name="btExport"
                        Grid.Row="1"
                        HorizontalAlignment="Center"
                        Visibility="Collapsed"
                        Margin="8"
                        />
                </Grid>
            </SplitView.Pane>
            <ScrollViewer
                x:Name="svPageZoom"
                IsTabStop="True"
                ZoomMode="Enabled"
                MinZoomFactor="0.1"
                MaxZoomFactor="10"
                HorizontalScrollMode="Enabled"
                VerticalScrollMode="Enabled"
                HorizontalScrollBarVisibility="Hidden"
                VerticalScrollBarVisibility="Hidden"
                >
                <StackPanel
                    x:Name="spPageView"
                    Orientation="Vertical"
                    Spacing="20"
                    >
                    <StackPanel.ChildrenTransitions>
                        <TransitionCollection>
                            <EntranceThemeTransition />
                            <ReorderThemeTransition />
                        </TransitionCollection>
                    </StackPanel.ChildrenTransitions>
                </StackPanel>
            </ScrollViewer>
        </SplitView>

        <Grid
            Grid.Row="3"
            HorizontalAlignment="Center"
            >
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto" />
                <ColumnDefinition Width="Auto" />
            </Grid.ColumnDefinitions>
            
            <InkToolbar
                x:Name="inkToolbar"
                Grid.Column="0"
                Margin="0, 0, 8, 0"
                ActiveToolChanged="InkToolChanged"
                InkDrawingAttributesChanged="InkToolChanged"
                InitialControls="PensOnly"
                HorizontalAlignment="Right"
                >
                <InkToolbarEraserButton
                    Checked="EraserChecked"
                    Unchecked="EraserUnchecked"
                    >
                    <FontIcon FontFamily="Segoe Fluent Icons" Glyph="&#xE75C;" />
                </InkToolbarEraserButton>
                <InkToolbarCustomToggleButton
                    Checked="RulerChecked"
                    Unchecked="RulerUnchecked"
                    >
                    <FontIcon FontFamily="Segoe Fluent Icons" Glyph="&#xECC6;" />
                </InkToolbarCustomToggleButton>
                <InkToolbarCustomToggleButton
                    Checked="ProtractorChecked"
                    Unchecked="ProtractorUnchecked"
                    >
                    <FontIcon FontFamily="Segoe Fluent Icons" Glyph="&#xF0B4;" />
                </InkToolbarCustomToggleButton>
            </InkToolbar>

            <Grid
                Grid.Column="1"
                Margin="8, 0, 0, 0"
                HorizontalAlignment="Left"
                >
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="256" />
                    <ColumnDefinition Width="Auto" />
                </Grid.ColumnDefinitions>
                <ScrollViewer
                    Grid.Column="0"
                    VerticalScrollMode="Disabled"
                    HorizontalScrollMode="Enabled"
                    VerticalScrollBarVisibility="Disabled"
                    HorizontalScrollBarVisibility="Hidden"
                    >
                    <StackPanel
                        Orientation="Horizontal"
                        Spacing="8"
                        >
                        <shared:SimpleColorPicker
                            x:Name="scColorBar"
                            Loaded="LoadColorBar"
                            />
                        <Button
                            Padding="0"
                            Width="32"
                            Height="32"
                            >
                            <FontIcon
                                Width="32"
                                Height="32"
                                HorizontalAlignment="Center"
                                VerticalAlignment="Center"
                                FontFamily="Segoe Fluent Icons"
                                Glyph="&#xE109;"
                                />
                            <Button.Flyout>
                                <Flyout
                                    x:Name="flNewColor"
                                    >
                                    <StackPanel>
                                        <muxc:ColorPicker
                                            x:Name="cpColor"
                                            />
                                        <Button
                                            Content="Add color"
                                            Click="AddNewColor"
                                            />
                                    </StackPanel>
                                </Flyout>
                            </Button.Flyout>
                        </Button>
                    </StackPanel>
                </ScrollViewer>
                <Slider
                    x:Name="slTipSize"
                    Width="256"
                    Loaded="LoadTipSize"
                    VerticalAlignment="Center"
                    Grid.Column="1"
                    Margin="8, 0, 0, 0"
                    ValueChanged="SetNewBrushWidth"
                    StepFrequency="1"
                    SmallChange="1"
                    LargeChange="2"
                    Minimum="1"
                    Maximum="24"
                    />
            </Grid>
        </Grid>
    </Grid>
</Page>
